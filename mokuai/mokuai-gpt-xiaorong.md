# 消融与对比实验设计（学术裁缝版）

> 目的：在不改变结论的前提下，通过系统性消融与对比验证新增模块的有效性与边界条件。  
> 原则：固定主干与训练协议，最小化变量改动；以模块级和组件级两条线并行验证；强调可复现与可解释。

---

## 一、实验设置对齐（与当前项目一致）

**数据集与划分**
- 核心实验集：ETTh1、ETTm1（与当前复现设置一致）。
- 扩展实验集：ETTh2、ETTm2、Weather（用于泛化验证）。
- 采用Time-LLM默认划分策略，保证与复现基线一致。

**输入输出长度**
- 主设置：`seq_len=512`，`pred_len=96`，`label_len=48`。
- 长预测扩展：`pred_len ∈ {192, 336, 720}`，用于验证长视界性能。

**模型与训练协议**
- 主干：Time-LLM冻结LLM主干，Qwen 2.5 3B（4-bit），`llm_dim=2048`，`llm_layers=6`。
- 结构：`d_model=32`，`d_ff=32`，`n_heads=8`，`e_layers=2`，`d_layers=1`，`dropout=0.1`。
- 训练：`batch_size=4/8`，`train_epochs=3~6`，固定随机种子，重复3次取均值。

---

## 二、评价指标（主指标 + 模块特异指标）

**主指标**
- MSE、MAE（对所有数据集与所有预测长度统一报告）。

**趋势与层级模块验证指标**
- Direction Accuracy（DA）：趋势方向判别准确率。
- Trend-F1：趋势类别宏平均F1。
- Magnitude MAE：对`|Δy|`的幅度误差。

**效率指标**
- 参数量（新增参数量与总参数量）。
- 单epoch训练时间与显存占用。

---

## 三、消融实验设计（模块级 + 组件级）

### 3.1 模块级消融矩阵（主实验）

| 实验编号 | 设定 | 目的 | 预期结论方向 |
|---|---|---|---|
| Exp-0 | Time-LLM 基线 | 复现与对照 | 基准性能 |
| Exp-1 | + MDFR（多尺度分解混合） | 验证多尺度输入增强 | MSE/MAE下降，长视界更明显 |
| Exp-2 | + RAHF（检索增强层级预测） | 验证层级+检索输出增强 | 拐点误差下降，DA/F1提升 |
| Exp-3 | + MDFR + RAHF | 验证协同效果 | 进一步提升，综合最优 |

### 3.2 MDFR 组件级消融（多尺度模块）

| 实验编号 | 改动 | 目的 | 预期观察 |
|---|---|---|---|
| Exp-1a | 单尺度替代多尺度 | 验证多尺度必要性 | 性能回退 |
| Exp-1b | 去除双向混合（仅拼接） | 验证跨尺度交互 | 长预测误差增大 |
| Exp-1c | 去除分解（仅多尺度patch） | 验证分解贡献 | 周期性数据回退 |
| Exp-1d | 尺度集合变化（{1,2,4} vs {1,4,16}） | 评估尺度敏感性 | 不同数据集差异化提升 |

### 3.3 RAHF 组件级消融（检索与层级模块）

| 实验编号 | 改动 | 目的 | 预期观察 |
|---|---|---|---|
| Exp-2a | 去除检索，仅保留层级预测 | 验证层级贡献 | DA/F1提升，数值提升有限 |
| Exp-2b | 去除层级，仅保留检索 | 验证检索贡献 | MSE下降，趋势指标提升有限 |
| Exp-2c | Top-k检索变化（1/5/10） | 评估检索规模 | K过大引入噪声 |
| Exp-2d | 去除检索融合门控 | 验证融合机制 | 泛化能力下降 |

---

## 四、对比实验设计（SOTA与代表性基线）

**对比对象建议**
- 传统基线：ARIMA、DLinear。
- Transformer类：Autoformer、FEDformer、Informer。
- Patch/混合类：PatchTST、TimesNet、TimeMixer。
- 结构改进类：iTransformer。
- LLM类对照：Time-LLM原版。

**对比原则**
- 使用相同数据划分、输入长度与预测长度。
- 不改变提示策略与LLM主干设定。
- 在同一硬件与相近训练预算下比较。

---

## 五、学术裁缝式验证策略（体现模块功效）

**数据集特性对齐**
1. ETTh1/ETTh2：周期性强，验证MDFR对多尺度趋势与季节性建模的增益。
2. ETTm1/ETTm2：长序列高频波动，验证MDFR在长预测与高频噪声条件下的鲁棒性。
3. Weather：多变量相关性强，验证RAHF在跨变量趋势判断与检索增强下的稳定性。

**难例切片验证**
1. 趋势拐点窗口：比较DA与拐点误差。
2. 高波动区间：比较误差方差与鲁棒性。
3. 稀有模式窗口：检索增强贡献最明显。

---

## 六、统计显著性与复现规范

1. 每组实验使用3个随机种子，报告均值与标准差。
2. 对核心指标进行配对t检验，标注显著性水平。
3. 记录训练时间、显存与参数量，提供公平性对照。
4. 所有实验只改变目标模块，其余配置完全一致。

---

## 七、结果呈现模板（不干扰结论）

**主结果表（示例结构）**

| 模型 | ETTh1 MSE | ETTh1 MAE | ETTm1 MSE | ETTm1 MAE | Weather MSE | Weather MAE |
|---|---|---|---|---|---|---|
| Time-LLM | 待测 | 待测 | 待测 | 待测 | 待测 | 待测 |
| +MDFR | 待测 | 待测 | 待测 | 待测 | 待测 | 待测 |
| +RAHF | 待测 | 待测 | 待测 | 待测 | 待测 | 待测 |
| +MDFR+RAHF | 待测 | 待测 | 待测 | 待测 | 待测 | 待测 |

**趋势指标表（示例结构）**

| 模型 | DA | Trend-F1 | Magnitude MAE |
|---|---|---|---|
| Time-LLM | 待测 | 待测 | 待测 |
| +RAHF | 待测 | 待测 | 待测 |
| +MDFR+RAHF | 待测 | 待测 | 待测 |

---

## 八、小结

- 实验设计强调“模块裁缝式”验证：对齐数据集特性与模块目标，避免冗余对比。
- 通过模块级与组件级消融，能清晰分离每个创新点的贡献。
- 全过程不预设结论，仅提供规范框架与可复现模板。

