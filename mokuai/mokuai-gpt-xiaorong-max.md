# 消融与对比实验设计（学术裁缝版·增强细化）

> 目标：在不改变既有结论的前提下，补全更具体、可复现、可审稿的消融与对比实验设计，并突出新增模块的效用与边界条件。  
> 原则：固定主干与训练协议；最小化变量改动；按“模块目标—数据特性—指标对齐”的裁缝式验证流程组织。

---

## 一、实验设置对齐（与当前项目一致）

**数据集与划分**
- 核心：ETTh1、ETTm1（已复现与脚本设置一致）。
- 扩展：ETTh2、ETTm2、Weather（泛化验证）。
- 划分策略采用Time-LLM默认配置，确保与基线一致。

**输入输出长度**
- 主设置：`seq_len=512`，`pred_len=96`，`label_len=48`。
- 长视界：`pred_len ∈ {192, 336, 720}`（验证长预测鲁棒性）。

**模型与训练协议**
- 主干：Time-LLM冻结LLM，Qwen 2.5 3B（4-bit），`llm_dim=2048`，`llm_layers=6`。
- 结构：`d_model=32`，`d_ff=32`，`n_heads=8`，`e_layers=2`，`d_layers=1`，`dropout=0.1`。
- 训练：`batch_size=4/8`，`epochs=3~6`，固定随机种子，重复3次取均值。

---

## 二、指标体系（主指标 + 模块特异指标 + 复杂度指标）

**主指标**
- MSE、MAE（全数据集、全预测长度统一报告）。

**趋势/层级预测相关指标（用于RAHF）**
- Direction Accuracy (DA)：趋势方向预测准确率。
- Trend-F1：趋势类别宏平均F1。
- Magnitude MAE：`|Δy|`幅度误差。

**检索增强相关指标（用于RAHF）**
- Retrieval Gain (RG)：启用检索与不启用检索的MSE差值。
- Rare-Pattern Improvement (RPI)：稀有模式窗口的MSE/MAE改善比例。

**复杂度与效率指标**
- 参数量（新增参数与总参数）。
- 单epoch训练时间、显存占用。

---

## 三、模块级消融设计（核心验证）

| 实验编号 | 设定 | 目的 | 预期趋势 |
|---|---|---|---|
| Exp-0 | Time-LLM 基线 | 复现与对照 | 基准性能 |
| Exp-1 | + MDFR | 验证多尺度分解-混合输入增强 | 长视界MSE下降 |
| Exp-2 | + RAHF | 验证检索增强与层级预测 | 拐点误差下降，DA/F1提升 |
| Exp-3 | + MDFR + RAHF | 验证协同效应 | 综合最优，稳健性提升 |

---

## 四、组件级消融设计（裁缝式验证）

### 4.1 MDFR 组件消融

| 实验编号 | 改动 | 目的 | 预期观察 |
|---|---|---|---|
| Exp-1a | 单尺度替代多尺度 | 验证多尺度必要性 | 长预测退化 |
| Exp-1b | 去除双向混合，仅拼接 | 验证跨尺度交互 | 周期数据回退 |
| Exp-1c | 去除分解，仅多尺度patch | 验证趋势/季节分解贡献 | 周期性下降 |
| Exp-1d | 调整尺度集合（{1,2,4} vs {1,4,16}） | 评估尺度敏感性 | 不同数据集表现差异 |

### 4.2 RAHF 组件消融

| 实验编号 | 改动 | 目的 | 预期观察 |
|---|---|---|---|
| Exp-2a | 仅层级预测，无检索 | 验证层级贡献 | DA/F1提升为主 |
| Exp-2b | 仅检索，无层级 | 验证检索贡献 | MSE下降为主 |
| Exp-2c | Top-k检索变化（1/5/10） | 评估检索规模 | K过大引噪声 |
| Exp-2d | 去除融合门控 | 验证融合机制 | 泛化能力下降 |

---

## 五、对比实验设计（SOTA与代表性基线）

**对比对象**
- 传统基线：ARIMA、DLinear。
- Transformer类：Autoformer、Informer、FEDformer。
- Patch/混合类：PatchTST、TimesNet、TimeMixer。
- 结构改进类：iTransformer。
- LLM对照：Time-LLM原版。

**对比规则**
- 统一数据划分、序列长度与预测长度。
- LLM对照模型保持相同提示策略与主干配置。
- 训练预算控制在相近范围。

---

## 六、“学术裁缝”式验证策略

**数据集—模块目标对齐**
1. ETTh1/ETTh2：周期性强，验证MDFR在趋势/季节解耦中的增益。
2. ETTm1/ETTm2：高频噪声，验证MDFR在多尺度平衡中的鲁棒性。
3. Weather：多变量相关性强，验证RAHF在跨变量趋势判断与检索增强下的稳定性。

**难例切片**
- 趋势拐点窗口（验证RAHF方向一致性）。
- 高波动窗口（验证MDFR稳健性）。
- 稀有模式窗口（验证检索增强贡献）。

---

## 七、统计显著性与复现规范

1. 每组实验固定3个随机种子，报告均值±标准差。
2. 对核心指标做配对t检验并标注显著性水平。
3. 记录训练时长、显存、参数量，用于公平性说明。
4. 仅改变目标模块，其余配置完全一致。

---

## 八、结果呈现模板（不干扰结论）

**主结果表**

| 模型 | ETTh1 MSE | ETTh1 MAE | ETTm1 MSE | ETTm1 MAE | Weather MSE | Weather MAE |
|---|---|---|---|---|---|---|
| Time-LLM | 待测 | 待测 | 待测 | 待测 | 待测 | 待测 |
| +MDFR | 待测 | 待测 | 待测 | 待测 | 待测 | 待测 |
| +RAHF | 待测 | 待测 | 待测 | 待测 | 待测 | 待测 |
| +MDFR+RAHF | 待测 | 待测 | 待测 | 待测 | 待测 | 待测 |

**趋势指标表**

| 模型 | DA | Trend-F1 | Magnitude MAE |
|---|---|---|---|
| Time-LLM | 待测 | 待测 | 待测 |
| +RAHF | 待测 | 待测 | 待测 |
| +MDFR+RAHF | 待测 | 待测 | 待测 |

---

## 九、小结

- 通过模块级与组件级两层消融，能够稳定识别新增模块的独立贡献与协同增益。
- “学术裁缝”策略保证验证路径与数据集特性严格对齐，降低无效对比。
- 设计只提供规范框架与可复现路径，不预设具体结论，避免干扰论文结论。

